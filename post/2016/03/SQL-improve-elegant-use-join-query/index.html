<!doctype html><html class="theme-next pisces use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet"><link href="//fonts.useso.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet"><link href="/css/main.css?v=5.0.1" rel="stylesheet"><meta name="keywords" content="SQL,Tech,Elegant,"><link rel="alternate" href="/atom.xml" title="Cat's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.0.1"><meta name="description" content="按照数据库设计原则，为了消除冗余，一般会将共通的属性值进行表拆分，零散的表可通过主外键将彼此联系起来，有时为了得到完整的结果，我们需要从多个表中获取结果后再拼合起来，就需要执行连接查询。"><meta property="og:type" content="article"><meta property="og:title" content="SQL查询提高篇：捋清连接查询的那些事儿"><meta property="og:url" content="http://amao12580.github.io/post/2016/03/SQL-improve-elegant-use-join-query/index.html"><meta property="og:site_name" content="Cat's Blog"><meta property="og:description" content="按照数据库设计原则，为了消除冗余，一般会将共通的属性值进行表拆分，零散的表可通过主外键将彼此联系起来，有时为了得到完整的结果，我们需要从多个表中获取结果后再拼合起来，就需要执行连接查询。"><meta property="og:updated_time" content="2016-05-17T08:39:33.401Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SQL查询提高篇：捋清连接查询的那些事儿"><meta name="twitter:description" content="按照数据库设计原则，为了消除冗余，一般会将共通的属性值进行表拆分，零散的表可通过主外键将彼此联系起来，有时为了得到完整的结果，我们需要从多个表中获取结果后再拼合起来，就需要执行连接查询。"><script id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Pisces",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:0x56ed168b0c000400,author:"这是作者大大"}}</script><title>SQL查询提高篇：捋清连接查询的那些事儿 | Cat's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Cat's Blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">一饮一啄，莫非前定.</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-index"><a href="/index" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>索引</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="#" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline">SQL查询提高篇：捋清连接查询的那些事儿</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2016-03-21T12:25:10+08:00" content="2016-03-21">2016-03-21</time></span> <span class="post-category">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/Learning/" itemprop="url" rel="index"><span itemprop="name">Learning</span></a></span></span> <span id="busuanzi_container_page_pv">&nbsp; | &nbsp; 热度&nbsp;<span id="busuanzi_value_page_pv"></span> °C</span> <span class="post-comments-count">&nbsp; | &nbsp;<a href="/post/2016/03/SQL-improve-elegant-use-join-query/#comments" itemprop="discussionUrl"><span class="post-comments-count ds-thread-count" data-thread-key="post/2016/03/SQL-improve-elegant-use-join-query/" itemprop="commentsCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>数据库中的表可通过外键将彼此联系起来。主键（Primary Key）是一个列，在这个列中的每一行的值都是唯一的。在表中，每个主键的值都是唯一的。这样做的目的是在不重复每个表中的所有数据的情况下，把表间的数据交叉捆绑在一起。</p><p>而在两个表之间建立关联关系，是不要求任何一个表的关联列(column)是主键的，这个关联列可以是任何类型的列，但是要求，两个表的关联列可以做关联关系的条件计算，为避免转换影响效率，两个关联列最好保持类型、长度一致。</p><p>为方便说明，定义以下2张表：<br></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">用户信息表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`uid`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户id'</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'姓名'</span>,</span><br><span class="line">  <span class="string">`sex`</span> tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'性别'</span>,</span><br><span class="line">  <span class="string">`age`</span> tinyint(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span>,</span><br><span class="line">  <span class="string">`mobile`</span> <span class="built_in">varchar</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'手机号码'</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</span><br><span class="line">  <span class="string">`register_time`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'注册时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`uid`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`index_mobile`</span> (<span class="string">`mobile`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`user`</span> <span class="keyword">VALUES</span> (<span class="string">'100'</span>, <span class="string">'张三'</span>, <span class="string">'1'</span>, <span class="string">'28'</span>, <span class="string">'13547521456'</span>, <span class="string">'ASDAWQ@!#SDF@#$%XCF'</span>, <span class="string">'2016-03-30 17:47:51'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`user`</span> <span class="keyword">VALUES</span> (<span class="string">'101'</span>, <span class="string">'李四'</span>, <span class="string">'2'</span>, <span class="string">'35'</span>, <span class="string">'17025856329'</span>, <span class="string">'234ASD@#$@#$AFSDFRT'</span>, <span class="string">'2016-03-30 17:48:34'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`user`</span> <span class="keyword">VALUES</span> (<span class="string">'102'</span>, <span class="string">'王五'</span>, <span class="string">'1'</span>, <span class="string">'48'</span>, <span class="string">'15925874536'</span>, <span class="string">'#$%SDFSDR@#$%@#$#@'</span>, <span class="string">'2016-03-30 17:53:49'</span>);</span><br><span class="line"></span><br><span class="line">订单信息表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`order`</span> (</span><br><span class="line">  <span class="string">`order_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单编号'</span>,</span><br><span class="line">  <span class="string">`uid`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户Id'</span>,</span><br><span class="line">  <span class="string">`amout`</span> mediumtext <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单金额(单位为分)'</span>,</span><br><span class="line">  <span class="string">`status`</span> tinyint(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单状态'</span>,</span><br><span class="line">  <span class="string">`order_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`order_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order`</span> <span class="keyword">VALUES</span> (<span class="string">'200'</span>, <span class="string">'100'</span>, <span class="string">'5899'</span>, <span class="string">'0'</span>, <span class="string">'2016-03-30 17:54:20'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order`</span> <span class="keyword">VALUES</span> (<span class="string">'201'</span>, <span class="string">'100'</span>, <span class="string">'6799'</span>, <span class="string">'0'</span>, <span class="string">'2016-03-30 17:54:38'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order`</span> <span class="keyword">VALUES</span> (<span class="string">'202'</span>, <span class="string">'101'</span>, <span class="string">'12699'</span>, <span class="string">'0'</span>, <span class="string">'2016-03-30 17:55:01'</span>);</span><br></pre></td></tr></table></figure><p></p><p>数据库现在2张表的数据看起来是这样：<br>user表</p><table><thead><tr><th>uid</th><th style="text-align:center">name</th><th style="text-align:right">sex</th><th style="text-align:right">age</th><th style="text-align:right">mobile</th><th style="text-align:right">password</th><th style="text-align:right">register_time</th></tr></thead><tbody><tr><td>100</td><td style="text-align:center">张三</td><td style="text-align:right">1</td><td style="text-align:right">28</td><td style="text-align:right">13547521456</td><td style="text-align:right">password</td><td style="text-align:right">2016-03-30 17:47:51</td></tr><tr><td>101</td><td style="text-align:center">李四</td><td style="text-align:right">2</td><td style="text-align:right">35</td><td style="text-align:right">17025856329</td><td style="text-align:right">password</td><td style="text-align:right">2016-03-30 17:48:34</td></tr><tr><td>102</td><td style="text-align:center">王五</td><td style="text-align:right">1</td><td style="text-align:right">48</td><td style="text-align:right">15925874536</td><td style="text-align:right">password</td><td style="text-align:right">2016-03-30 17:53:49</td></tr></tbody></table><p>order表</p><table><thead><tr><th>order_id</th><th style="text-align:center">uid</th><th style="text-align:right">amout</th><th style="text-align:right">status</th><th style="text-align:right">order_time</th></tr></thead><tbody><tr><td>200</td><td style="text-align:center">100</td><td style="text-align:right">5899</td><td style="text-align:right">0</td><td style="text-align:right">2016-03-30 17:54:20</td></tr><tr><td>201</td><td style="text-align:center">100</td><td style="text-align:right">6799</td><td style="text-align:right">0</td><td style="text-align:right">2016-03-30 17:54:38</td></tr><tr><td>202</td><td style="text-align:center">101</td><td style="text-align:right">12699</td><td style="text-align:right">0</td><td style="text-align:right">2016-03-30 17:55:01</td></tr></tbody></table><h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><p>查询所有用户的订单信息，订单信息不能为空，要求返回的字段有：用户姓名、手机号码、订单号、订单状态、订单金额。</p><h3 id="left-join-VS-right-join"><a href="#left-join-VS-right-join" class="headerlink" title="left join VS right join"></a>left join VS right join</h3><p>规律：</p><ul><li>A表 left join B表；则返回A表的所有符合条件(on条件、where条件)的记录。A表的字段不会为null，而B表没有对应记录时,字段值返回null。</li><li><p>B表 left join A表；则返回B表的所有符合条件(on条件、where条件)的记录。B表的字段不会为null，而A表没有对应记录时,字段值返回null。</p></li><li><p>A表 left join B表 等价于 B表 right join A表.</p></li><li>A表 right join B表 等价于 B表 left join A表.</li></ul><p>正确的SQL语句：<br></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT `user`.`name`,`user`.mobile,`order`.order_id,`order`.`status`,`order`.amout</span><br><span class="line"> FROM `user` RIGHT JOIN `order` ON `user`.uid=`order`.uid</span><br><span class="line"></span><br><span class="line">等价于</span><br><span class="line"></span><br><span class="line">SELECT `user`.`name`,`user`.mobile,`order`.order_id,`order`.`status`,`order`.amout</span><br><span class="line"> FROM `order` LEFT JOIN `user` ON `user`.uid=`order`.uid</span><br></pre></td></tr></table></figure><p></p><p>结果集是：</p><table><thead><tr><th>name</th><th style="text-align:center">mobile</th><th style="text-align:right">order_id</th><th style="text-align:right">status</th><th style="text-align:right">amout</th></tr></thead><tbody><tr><td>张三</td><td style="text-align:center">13547521456</td><td style="text-align:right">200</td><td style="text-align:right">0</td><td style="text-align:right">5899</td></tr><tr><td>张三</td><td style="text-align:center">13547521456</td><td style="text-align:right">201</td><td style="text-align:right">0</td><td style="text-align:right">6799</td></tr><tr><td>李四</td><td style="text-align:center">17025856329</td><td style="text-align:right">202</td><td style="text-align:right">0</td><td style="text-align:right">12699</td></tr></tbody></table><p>错误的SQL语句：<br></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT `user`.`name`,`user`.mobile,`order`.order_id,`order`.`status`,`order`.amout</span><br><span class="line"> FROM `user` LEFT JOIN `order` ON `user`.uid=`order`.uid</span><br><span class="line"></span><br><span class="line">等价于</span><br><span class="line"></span><br><span class="line">SELECT `user`.`name`,`user`.mobile,`order`.order_id,`order`.`status`,`order`.amout</span><br><span class="line"> FROM `order` RIGHT JOIN `user` ON `user`.uid=`order`.uid</span><br></pre></td></tr></table></figure><p></p><p>结果集是：</p><table><thead><tr><th>name</th><th style="text-align:center">mobile</th><th style="text-align:right">order_id</th><th style="text-align:right">status</th><th style="text-align:right">amout</th></tr></thead><tbody><tr><td>张三</td><td style="text-align:center">13547521456</td><td style="text-align:right">200</td><td style="text-align:right">0</td><td style="text-align:right">5899</td></tr><tr><td>张三</td><td style="text-align:center">13547521456</td><td style="text-align:right">201</td><td style="text-align:right">0</td><td style="text-align:right">6799</td></tr><tr><td>李四</td><td style="text-align:center">17025856329</td><td style="text-align:right">202</td><td style="text-align:right">0</td><td style="text-align:right">12699</td></tr><tr><td>王五</td><td style="text-align:center">15925874536</td><td style="text-align:right">null</td><td style="text-align:right">null</td><td style="text-align:right">null</td></tr></tbody></table><p>可以看出错误的SQL语句中，查出了没有订单的用户“王五”</p><h3 id="inner-join"><a href="#inner-join" class="headerlink" title="inner join"></a>inner join</h3><p>规律：</p><ul><li>A表 inner join B表；则返回A表和B表同时符合条件(on条件、where条件)的记录。</li></ul><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">两种写法，后者使用的居多</span><br><span class="line"></span><br><span class="line">SELECT `user`.`name`,`user`.mobile,`order`.order_id,`order`.`status`,`order`.amout</span><br><span class="line"> FROM `order` INNER JOIN `user` ON `user`.uid=`order`.uid<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">等价于</span><br><span class="line"></span><br><span class="line">SELECT `user`.`name`,`user`.mobile,`order`.order_id,`order`.`status`,`order`.amout</span><br><span class="line"> FROM `order`,`user` WHERE `user`.uid=`order`.uid<span class="comment">;</span></span><br></pre></td></tr></table></figure><h3 id="left-outter-join-VS-right-outter-join"><a href="#left-outter-join-VS-right-outter-join" class="headerlink" title="left outter join VS right outter join"></a>left outter join VS right outter join</h3><p>left join 是left outer join的简写，left join默认是outer属性的。</p><p>在某些数据库(如Oracle)中， left join 称为 left outer join；相应的right join 称为 right outter join</p><h3 id="full-join"><a href="#full-join" class="headerlink" title="full join"></a>full join</h3><ul><li>在某些数据库中， FULL JOIN 称为 FULL OUTER JOIN。</li><li>只要其中某个表存在匹配，FULL JOIN 关键字就会返回行，意思是只需要有一个以上的表满足条件即可。</li><li><p>Oracle 、DB2、SQL Server、PostgreSQL 支持 Full JOIN，但是 MySQL 是不支持的。</p><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MySQL</span>使用<span class="type">FULL</span> <span class="type">JOIN</span>报错</span><br><span class="line">[<span class="type">Err</span>] <span class="number">1054</span> - <span class="type">Unknown</span> column <span class="symbol">'order</span>.uid' <span class="keyword">in</span> <span class="symbol">'on</span> clause'</span><br></pre></td></tr></table></figure></li><li><p>MySQL可以通过 LEFT JOIN + UNION + RIGHT JOIN 的方式 来实现Full JOIN。</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select `user`.`name`,`user`.mobile,`order`.order_id,`order`.`status`,`order`.amout</span><br><span class="line"> from `order` left join `user` on `user`.uid=`order`.uid</span><br><span class="line"> union</span><br><span class="line">select `user`.`name`,`user`.mobile,`order`.order_id,`order`.`status`,`order`.amout</span><br><span class="line"> from `order` right join `user` on `user`.uid=`order`.uid<span class="comment">;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="cross-join"><a href="#cross-join" class="headerlink" title="cross join"></a>cross join</h3><p>除了在FROM子句中使用逗号间隔连接的表外，SQL还支持另一种被称为交叉连接的操作，它们都返回被连接的两个表所有数据行的笛卡尔积，返回到的数据行数等于第一个表中符合查询条件的数据行数乘以第二个表中符合查询条件的数据行数。惟一的不同在于，交叉连接分开列名时，使用CROSS JOIN关键字而不是逗号。</p><p>实际上，下面两个表达式是完全等价的。<br></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  *  <span class="keyword">FROM</span>  table1, table2 <span class="keyword">WHERE</span> table1.<span class="keyword">name</span>=table2.<span class="keyword">name</span>;</span><br><span class="line"><span class="keyword">SELECT</span>  *  <span class="keyword">FROM</span>  table1  <span class="keyword">CROSS</span> <span class="keyword">JOIN</span>  table2 <span class="keyword">WHERE</span> table1.<span class="keyword">name</span>=table2.<span class="keyword">name</span>;</span><br></pre></td></tr></table></figure><p></p><p>在使用CROSS JOIN关键字交叉连接表时，因为生成的是两个表的笛卡尔积，因而不能使用ON关键字，只能在WHERE子句中定义搜索条件。</p><p>事实上，直接使用CROSS JOIN很少得到想要的结果，但是，正如实例所示，作为查询的第一步，DBMS通常在FROM子句中，对连接的表进行CROSS JOIN，然后过滤得到的中间表。</p><h3 id="union-union-all"><a href="#union-union-all" class="headerlink" title="union,union all"></a>union,union all</h3><p>在数据库中，union和union all关键字都是将两个结果集合并为一个，但这两者从使用和效率上来说都有所不同。</p><p>union在进行表链接后会筛选掉重复的记录，所以在表链接后会对所产生的结果集进行排序运算，删除重复的记录再返回结果。</p><p>如：<br>select <em>from test_union1<br>union<br>select</em> from test_union2</p><p>这个SQL在运行时先取出两个表的结果，再用排序空间进行排序删除重复的记录，最后返回结果集，如果表数据量大的话可能会导致用磁盘进行排序。而union all只是简单的将两个结果合并后就返回。这样，如果返回的两个结果集中有重复的数据，那么返回的结果集就会包含重复的数据了。从效率上说，union all要比union快很多，所以，如果可以确认合并的两个结果集中不包含重复的数据的话，那么就使用union all，</p><p>如下：<br>select <em>from test_union1<br>union all<br>select</em> from test_union2</p><p>使用 union 组合查询的结果集有两个最基本的规则：<br>1。所有查询中的列数和列的顺序必须相同。<br>2。数据类型必须兼容</p><h3 id="Apache-Hive连接查询"><a href="#Apache-Hive连接查询" class="headerlink" title="Apache Hive连接查询"></a>Apache Hive连接查询</h3><p>Hive支持连接查询，但有一些条件必须遵守，比如只支持相等查询，其它查询如不等式查询则不支持，还支持外连接，左半连接查询。另外Hive支持多于两个表以上的连接查询。</p><ul><li><a href="http://blog.csdn.net/skywalker_only/article/details/39205973" target="_blank" rel="external">Hive学习之连接查询</a></li><li><a href="http://shiyanjun.cn/archives/588.html" target="_blank" rel="external">Hive JOIN使用详解</a><h3 id="结合explain进行执行分析"><a href="#结合explain进行执行分析" class="headerlink" title="结合explain进行执行分析"></a>结合explain进行执行分析</h3></li><li><a href="http://blog.csdn.net/mchdba/article/details/9190771" target="_blank" rel="external">MySQL EXPLAIN 命令详解学习</a></li></ul><h3 id="数据库设计准则"><a href="#数据库设计准则" class="headerlink" title="数据库设计准则"></a>数据库设计准则</h3><ul><li><p>一范式就是属性不可分割。属性是什么？就是表中的字段。不可分割的意思就按字面理解就是最小单位，不能再分成更小单位了。这个字段只能是一个值，不能被拆分成多个字段，否则的话，它就是可分割的，就不符合一范式。不过能不能分割并没有绝对的答案，看需求，也就是看你的设计目标而定。</p></li><li><p>二范式就是要有主键，要求其他字段都依赖于主键。为什么要有主键？没有主键就没有唯一性，没有唯一性在集合中就定位不到这行记录，所以要主键。其他字段为什么要依赖于主键？因为不依赖于主键，就找不到他们。更重要的是，其他字段组成的这行记录和主键表示的是同一个东西，而主键是唯一的，它们只需要依赖于主键，也就成了唯一的。</p></li><li><p>三范式就是要消除传递依赖，方便理解，可以看做是“消除冗余”。消除冗余应该比较好理解一些，就是各种信息只在一个地方存储，不出现在多张表中。</p></li></ul></div><div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>Talk is cheap，show me the code.</div><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/rewards/wechat-reward-image.png" alt="Steven Cheng WeChat Pay"><p>微信打赏</p></div></div></div></div><footer class="post-footer"><div class="copyright" style="clear:both"><p><span>本文标题：</span><a href="/post/2016/03/SQL-improve-elegant-use-join-query/">SQL查询提高篇：捋清连接查询的那些事儿</a></p><p><span>文章作者：</span><a href="/" title="访问 Steven Cheng 的个人博客">Steven Cheng</a></p><p><span>发布时间：</span>2016年3月21日 - 12时03分</p><p><span>本文字数：</span><span class="page-count">4,662字</span></p><p><span>原始链接：</span><a href="/post/2016/03/SQL-improve-elegant-use-join-query/" title="SQL查询提高篇：捋清连接查询的那些事儿">http://amao12580.github.io/post/2016/03/SQL-improve-elegant-use-join-query/</a></p><p><span>许可协议：</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" title="Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)">Attribution-NonCommercial 4.0</a></p><p><span>转载请保留以上信息。</span></p></div><div class="post-tags"><a href="/tags/SQL/" rel="tag">#SQL</a> <a href="/tags/Tech/" rel="tag">#Tech</a> <a href="/tags/Elegant/" rel="tag">#Elegant</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"></div><div class="post-nav-prev post-nav-item"><a href="/post/2016/03/A-successful-redis-tuning-record/" rel="prev" title="记一次redis成功调优的过程">记一次redis成功调优的过程<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><p>热评文章</p><div class="ds-top-threads" data-range="weekly" data-num-items="4"></div><div class="comments" id="comments"><div class="ds-thread" data-thread-key="post/2016/03/SQL-improve-elegant-use-join-query/" data-title="SQL查询提高篇：捋清连接查询的那些事儿" data-url="http://amao12580.github.io/post/2016/03/SQL-improve-elegant-use-join-query/"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Steven Cheng"><p class="site-author-name" itemprop="name">Steven Cheng</p><p class="site-description motion-element" itemprop="description">http://amao12580.github.io/about</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">4</span> <span class="site-state-item-name">分类</span></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">38</span> <span class="site-state-item-name">标签</span></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/amao12580" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://segmentfault.com/blogs" title="SegmentFault" target="_blank">SegmentFault</a></li><li class="links-of-blogroll-item"><a href="http://blog.jobbole.com/" title="伯乐在线" target="_blank">伯乐在线</a></li><li class="links-of-blogroll-item"><a href="http://cnpolitics.org/" title="政见" target="_blank">政见</a></li><li class="links-of-blogroll-item"><a href="http://dajia.qq.com/" title="大家" target="_blank">大家</a></li><li class="links-of-blogroll-item"><a href="http://www.importnew.com/" title="ImportNew" target="_blank">ImportNew</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#练习题"><span class="nav-number">1.</span> <span class="nav-text">练习题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#left-join-VS-right-join"><span class="nav-number">1.1.</span> <span class="nav-text">left join VS right join</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inner-join"><span class="nav-number">1.2.</span> <span class="nav-text">inner join</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#left-outter-join-VS-right-outter-join"><span class="nav-number">1.3.</span> <span class="nav-text">left outter join VS right outter join</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#full-join"><span class="nav-number">1.4.</span> <span class="nav-text">full join</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cross-join"><span class="nav-number">1.5.</span> <span class="nav-text">cross join</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#union-union-all"><span class="nav-number">1.6.</span> <span class="nav-text">union,union all</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Apache-Hive连接查询"><span class="nav-number">1.7.</span> <span class="nav-text">Apache Hive连接查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结合explain进行执行分析"><span class="nav-number">1.8.</span> <span class="nav-text">结合explain进行执行分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库设计准则"><span class="nav-number">1.9.</span> <span class="nav-text">数据库设计准则</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2016</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Steven Cheng</span> <span class="post-count">&nbsp全站共84.5k字</span></div><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>访问量<span id="busuanzi_value_site_pv"></span> &nbsp 您是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴<script>var OriginTitile=document.title,st;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="(つェ⊂)我藏好了哦",clearTimeout(st)):(document.title="(*´∇｀*)  被你发现啦~ "+OriginTitile,console.log("show"),st=setTimeout(function(){document.title=OriginTitile},4e3))})</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script><script src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script><script src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script><script src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script><script src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script><script src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script src="/js/src/utils.js?v=5.0.1"></script><script src="/js/src/motion.js?v=5.0.1"></script><script src="/js/src/affix.js?v=5.0.1"></script><script src="/js/src/schemes/pisces.js?v=5.0.1"></script><script src="/js/src/scrollspy.js?v=5.0.1"></script><script src="/js/src/post-details.js?v=5.0.1"></script><script src="/js/src/bootstrap.js?v=5.0.1"></script><script>var duoshuoQuery={short_name:"amao12580"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.id="duoshuo-script",t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementById("footer")||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script>function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),s=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!0,s=r.title.trim().toLowerCase(),n=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=r.url,i=-1,l=-1,p=-1;if(""!=s&&""!=n&&a.forEach(function(e,t){i=s.indexOf(e),l=n.indexOf(e),0>i&&0>l?c=!1:(0>l&&(l=0),0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+s+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;0>u&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),s.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").mousedown(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script></body></html>